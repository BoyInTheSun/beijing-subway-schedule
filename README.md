# beijing-subway-schedule

北京地铁时刻表，包含*北京地铁*和*京港地铁*。

基于本项目开发的动态可视化列车运行图，请见[beijing-subway-routemap](https://github.com/BoyInTheSun/beijing-subway-routemap)。***（正在开发中）***

***目前数据不完整，正在整理中***

## 项目结构

[imgs](imgs)是从[网站](#数据来源)爬取的原始**到站时刻表**图片。列车实际运行状态可能与此不符，产生的一切后果，我并不对此负责，后文不做赘述。

[arrival_schedule](arrival_schedule)是经过处理的**到站时刻表**。部分内容可能和原始图片有出入，详见[数据处理](#数据处理)

[train_schedule](train_schedule)是由前者转换而来的**列车时刻表**，形如`{虚拟车号: [[站1, 05:00], [站2, 05:03], ...], ...}`。这里的`虚拟车号`是按照开始运行的时间由小至大排列的。
特别地，由于6号线存在越行列车，**在站待避列车**形如`{..., ["物资学院路", "07:35"], ["草房", "07:38"], ["常营", "07:40-"], ["常营", "07:43"], ["黄渠", "07:45"], ["褡裢坡", "07:47"], ...`，**越行列车和其他通过不停车情况**形如`{..., ["物资学院路", "07:37"], ["草房", "07:40"], ["常营", "(07:42"], ["黄渠", "(07:44"], ["褡裢坡", "07:45"], ...}`。。

[train_schedule_all](train_schedule_all)是由前者合并而来的，区分工作日和双休日。形如`{线路名：{运行方向：{虚拟车号: [[站1, 05:00], [站2, 05:03], ...], ...}, ...}, ...}`。这里的`虚拟车号`形如`AABCCC`，`AA`代表线路名，详见[统计表格](#统计表格)，`B`代表双休日/单休日和运行方向，0-4代表工作日，5-9代表双休日，取模5余n代表运行方向（目前仅有0-1）。`CCC`按照列车开始运行的时间由小至大排列。

[station_spacing](station_spacing)是官网公布的站间距信息。虽然我也不知道这个有什么用。也许可以用来计算乘车价格？

## 数据来源

北京地铁有多个运营公司，分别是[北京市地铁运营有限公司](https://www.bjsubway.com/contact/)、[北京京港地铁有限公司](https://www.mtr.bj.cn/)、[北京市轨道交通运营管理有限公司](http://www.bjmoa.cn/)、北京公交有轨电车有限公司等。在上述网站（的前二者）中，官网公布了各地铁站的**到站时刻表**（其中北京轨道运营未公开时刻表）。

## 数据处理

爬取**到站时刻表**图片，用一定的规则将其转换为二值图，进行OCR，错误识别需人工纠错，转换为**列车时刻表**，期间需要对时刻表的错误进行人工纠错。

经过考虑后，我并不打算对处理过程的代码和中间文件开源，一是因为代码质量差，依赖复杂，可读性不佳，二是仅需单次运行，即可获得结果，且更新频率极低。

对于官方时刻表的错误，可以说是意料之中、情理之外。幸运的是，正确的时刻表是占多数的，我能根据其他推算出如何修改错误时刻表。或者说，我假定多数为正确的。

在[memo.md](memo.md)中展示了人工纠错的所有操作。

上述过程极易出现错误，如果你发现了任何问题，请提issue，我会及时核对。

## 统计表格

| 线路 | 代号 | 色号 | 运营公司 | 数据来源 | 上次更新 |
|---|---|---|---|---|---|
| 1号线八通线 | 01 | #C23A30 | 北京地铁 | 官网 | 2024-1-23 |
| 2号线 | 02 | #006098 | 北京地铁 | 官网 | 2024-1-23 |
| 4号线大兴线 | 04 | #008E9C | 京港地铁 | 官网 | 待整理 |
| 5号线 | 05 | #A6217F | 北京地铁 | 官网 | 2024-1-24 |
| 6号线 | 06 | #D29700 | 北京地铁 | 官网 | 2024-1-27 |
| 7号线 | 07 | #F6C582 | 北京地铁 | 官网 | 待整理 |
| 8号线 | 08 | #009B6B | 北京地铁 | 官网 | 待整理 |
| 9号线 | 09 | #8FC31F | 北京地铁 | 官网 | 待整理 |
| 10号线 | 10 | #009BC0 | 北京地铁 | 官网 | 待整理 |
| 11号线 | 11 | #ED796B | 北京地铁 | 官网 | 待整理 |
| 13号线 | 13 | #F9E700 | 北京地铁 | 官网 | 待整理 |
| 14号线 | 14 | #D5A7A1 | 京港地铁 | 官网 | 待整理 |
| 15号线 | 15 | #582C68 | 北京地铁 | 官网 | 待整理 |
| 16号线 | 16 | #76A32E | 京港地铁 | 官网 | 待整理 |
| 17号线 | 17 | #00A9A9 | 京港地铁 | 官网 | 待整理 |
| 19号线 | 19 | #D6ABC1 | 北京轨道运营 | - | - |
| S1线 | S1 | #B35A02 | 北京地铁 | 官网 | 待整理 |
| 亦庄T1线 | T1 | #E5061B | 北京公交有轨电车 | - | - |
| 亦庄线 | YZ | #E40077 | 北京地铁 | 官网 | 待整理 |
| 大兴机场线 | DJ | #004A9F | 北京轨道运营 | - | - |
| 房山线 | FS | #E46022 | 北京地铁 | 官网 | 待整理 |
| 昌平线 | CP | #DE82B2 | 北京地铁 | 官网 | 待整理 |
| 燕房线 | YF | #E46022 | 北京轨道运营 | - | - |
| 西郊线 | XJ | #E50619 | 北京公交有轨电车 | - | - |
| 首都机场线 | SJ | #A29BBB | 北京地铁 | 官网 | 待整理 |
